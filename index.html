<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<title>Okey 101 Skor Takip Sistemi</title>
<style>
  body{font-family:"Segoe UI",sans-serif;background:#f3f6fb;color:#2c3e50;margin:0}
  h1{text-align:center;padding:20px;background:#4a90e2;color:#fff;margin:0 0 20px}
  .container{max-width:1100px;margin:auto;background:#fff;border-radius:10px;box-shadow:0 4px 10px rgba(0,0,0,.1);padding:20px}
  label{display:block;margin-top:10px;font-weight:600}
  input,select{padding:5px 8px;border-radius:6px;border:1px solid #ccc;width:100%;box-sizing:border-box}
  table{width:100%;border-collapse:collapse;margin-top:20px}
  th,td{border:1px solid #ddd;text-align:center;vertical-align:middle;padding:8px}
  th{background:#4a90e2;color:#fff}
  .btn{background:#4a90e2;color:#fff;border:none;padding:10px 20px;border-radius:6px;cursor:pointer;margin-top:20px;font-weight:bold}
  .btn:hover{background:#357ABD}
  .hidden{display:none}
  .section-title{background:#e9f0ff;padding:10px;font-weight:bold;margin-top:20px;border-radius:6px}
  .player-cell{font-size:13px;text-align:center}
  .kategori{border:1px solid #eee;margin:2px;padding:6px;border-radius:6px;background:#f9f9f9}
  .kategori h4{margin:2px 0 6px;font-size:13px;color:#4a90e2}
  .secenek{display:inline-block;margin:4px 6px;padding:3px 8px;border-radius:5px;cursor:pointer;transition:.2s}
  .secenek:hover{background:#e0edff}
  .secenek.aktif{background:#2ecc71;color:#fff;font-weight:bold}
  .locked input,.locked .secenek,.locked button{pointer-events:none;opacity:.6}
  .ceza-satiri{margin:4px 0}
  .ceza-satiri button{width:26px;height:26px;border:none;border-radius:4px;cursor:pointer;color:#fff;font-weight:bold;font-size:14px}
  .ceza-satiri .azalt{background:#e74c3c}
  .ceza-satiri .azalt:hover{background:#c0392b}
  .ceza-satiri .artir{background:#2ecc71}
  .ceza-satiri .artir:hover{background:#27ae60}
  input[type="number"]{width:70px;text-align:center}
</style>
</head>
<body>
<h1>üßÆ Okey 101 Skor Takip Sistemi</h1>

<!-- Gƒ∞Rƒ∞≈û -->
<div class="container" id="ayarEkrani">
  <div class="section-title">Oyun Ayarlarƒ±</div>
  <label>Oyun T√ºr√º:</label>
  <select id="oyunTuru" onchange="oyunTuruDegisti()">
    <option value="tek">Tekli</option>
    <option value="esli">E≈üli</option>
  </select>

  <div id="esliSecenekleri" class="hidden">
    <label>E≈üli Oyun Tipi:</label>
    <select id="esliTipi" onchange="oyunTuruDegisti()">
      <option value="birlikte">Birlikte (takƒ±m puanƒ±)</option>
      <option value="ayri">Ayrƒ± Ayrƒ± (bireysel puan)</option>
    </select>
  </div>

  <label>Ka√ß tur oynanacak?</label>
  <input type="number" id="turSayisi" min="1" max="50" value="10">

  <div id="oyuncularAlani" class="section-title">ƒ∞simler</div>
  <div id="isimler"></div>

  <button class="btn" onclick="oyunaBasla()">OYUNA BA≈ûLA</button>
</div>

<!-- TABLO -->
<div class="container hidden" id="oyunEkrani">
  <div id="oyunBilgisi"></div>
  <table id="skorTablo"></table>
  <button class="btn" onclick="yeniOyun()">Yeni Oyun Ba≈ülat</button>
</div>

<script>
function oyunTuruDegisti(){
  const tur = document.getElementById("oyunTuru").value;
  const esliSec = document.getElementById("esliSecenekleri");
  const tip = document.getElementById("esliTipi") ? document.getElementById("esliTipi").value : "birlikte";
  const isimler = document.getElementById("isimler");

  if(tur==="esli"){ esliSec.classList.remove("hidden"); } else { esliSec.classList.add("hidden"); }

  // Tekli ve E≈üli-Ayrƒ±: 4 oyuncu. E≈üli-Birlikte: 2 takƒ±m adƒ±.
  if(tur==="tek" || (tur==="esli" && tip==="ayri")){
    isimler.innerHTML = `
      <label>Oyuncu 1:</label><input id="i1" value="Oyuncu 1">
      <label>Oyuncu 2:</label><input id="i2" value="Oyuncu 2">
      <label>Oyuncu 3:</label><input id="i3" value="Oyuncu 3">
      <label>Oyuncu 4:</label><input id="i4" value="Oyuncu 4">`;
  }else{
    isimler.innerHTML = `
      <label>Takƒ±m 1:</label><input id="i1" value="Takƒ±m 1">
      <label>Takƒ±m 2:</label><input id="i3" value="Takƒ±m 2">`;
  }
}
oyunTuruDegisti();

function oyunaBasla(){
  const tur = document.getElementById("oyunTuru").value;
  const tip = document.getElementById("esliTipi") ? document.getElementById("esliTipi").value : "birlikte";
  const turSayisi = parseInt(document.getElementById("turSayisi").value);

  const i1 = document.getElementById("i1").value;
  const i2 = document.getElementById("i2") ? document.getElementById("i2").value : "";
  const i3 = document.getElementById("i3").value;
  const i4 = document.getElementById("i4") ? document.getElementById("i4").value : "";

  let basliklar = [];
  let teamPairs = null; // sadece e≈üli-ayrƒ± i√ßin [[0,1],[2,3]]
  if(tur==="tek"){ basliklar = [i1,i2,i3,i4]; }
  else if(tip==="birlikte"){ basliklar = [i1,i3]; }
  else { basliklar = [i1,i2,i3,i4]; teamPairs = [[0,1],[2,3]]; }

  document.getElementById("ayarEkrani").classList.add("hidden");
  document.getElementById("oyunEkrani").classList.remove("hidden");
  document.getElementById("oyunBilgisi").innerHTML =
    `<h3>${tur==="tek"?"Tekli":"E≈üli"}${tur==="esli"?" - "+(tip==="birlikte"?"Birlikte":"Ayrƒ± ayrƒ±"):""} | Tur: ${turSayisi}</h3>`;

  // tablo kur
  let html = "<tr><th>El</th>";
  basliklar.forEach(b=> html += `<th>${b}</th>`);
  html += "</tr>";

  for(let el=1; el<=turSayisi; el++){
    html += `<tr data-row="${el}"><td><b>${el}</b></td>`;
    for(let c=0; c<basliklar.length; c++){
      html += `
        <td class="player-cell" data-row="${el}" data-col="${c}">
          <div class="kategori kat1">
            <h4>1Ô∏è‚É£ A√ßma Durumu</h4>
            <span class="secenek acmadi">A√ßamadƒ±</span>
            <span>Elinde: <input type="number" class="elinde" min="0" max="200"></span>
          </div>
          <div class="kategori kat2">
            <h4>2Ô∏è‚É£ Bitme T√ºr√º</h4>
            <span class="secenek bitme">Bitti</span>
            <span class="secenek bitme">Elden Bitti</span>
            <span class="secenek bitme">√áiftle Bitti</span>
            <span class="secenek okey hidden">Okey ile</span>
          </div>
          <div class="kategori kat3">
            <h4>3Ô∏è‚É£ Cezalar / Masa A≈üƒ±mƒ±</h4>
            <span class="secenek masa">Masa A≈ütƒ±</span>
            <div class="ceza-satiri">ƒ∞≈ülek Atma:
              <button class="azalt">-</button><span class="deger islek">0</span><button class="artir">+</button>
            </div>
            <div class="ceza-satiri">Hatalƒ± A√ßma:
              <button class="azalt">-</button><span class="deger hatali">0</span><button class="artir">+</button>
            </div>
            <div class="ceza-satiri">Okey Kaptƒ±rma:
              <button class="azalt">-</button><span class="deger kaptir">0</span><button class="artir">+</button>
            </div>
          </div>
        </td>`;
    }
    html += "</tr>";
  }
  document.getElementById("skorTablo").innerHTML = html;
  attachHandlers(tur, tip, teamPairs);
}

function attachHandlers(tur, tip, teamPairs){
  const table = document.getElementById("skorTablo");

  // h√ºcre i√ßi davranƒ±≈ülar
  table.querySelectorAll(".player-cell").forEach(cell=>{
    const kat1 = cell.querySelector(".kat1");
    const kat2 = cell.querySelector(".kat2");
    const acmadi = kat1.querySelector(".acmadi");
    const elinde = kat1.querySelector(".elinde");
    const bitmeler = kat2.querySelectorAll(".bitme");
    const okey = kat2.querySelector(".okey");
    const masaBtn = cell.querySelector(".masa");

    // 1) A√ßma
    acmadi.addEventListener("click", ()=>{
      const aktif = acmadi.classList.toggle("aktif");
      elinde.disabled = aktif;
      kat2.style.display = aktif ? "none" : "block";
    });
    elinde.addEventListener("input", ()=>{
      if(elinde.value!==""){ acmadi.style.display="none"; kat2.style.display="none"; }
      else { acmadi.style.display="inline-block"; kat2.style.display="block"; }
    });

    // 2) Bitme + Okey ile
    bitmeler.forEach(bit=>{
      bit.addEventListener("click", ()=>{
        const zatenAktif = bit.classList.contains("aktif");

        // hepsini g√∂r√ºn√ºr ve pasif yap
        bitmeler.forEach(b=>{ b.classList.remove("aktif"); b.style.display="inline-block"; });
        okey.classList.add("hidden"); okey.classList.remove("aktif");

        if(!zatenAktif){
          bit.classList.add("aktif");
          // sadece bu bitme kalsƒ±n
          bitmeler.forEach(b=>{ if(b!==bit) b.style.display="none"; });
          // a√ßma gizlensin
          kat1.style.display="none";
          // "Okey ile" √ßƒ±ksƒ±n
          okey.classList.remove("hidden");

          // E≈üli-Ayrƒ±: partnerin bitmesini sƒ±fƒ±rla
          if(tur==="esli" && tip==="ayri" && teamPairs){
            clearPartnerBitmeInSameRow(cell, teamPairs);
          }
        } else {
          // bitme iptal ‚Üí a√ßma geri gelsin
          kat1.style.display="block";
        }
      });
    });
    okey.addEventListener("click", ()=>{ okey.classList.toggle("aktif"); });

    // 3) Masa A≈ütƒ±
    masaBtn.addEventListener("click", ()=>{ masaBtn.classList.toggle("aktif"); });

    // 4) Cezalar +/- (min 0)
    cell.querySelectorAll(".ceza-satiri").forEach(row=>{
      const minus = row.querySelector(".azalt");
      const plus  = row.querySelector(".artir");
      const valEl = row.querySelector(".deger");
      minus.addEventListener("click", ()=>{
        let v = parseInt(valEl.textContent); if(v>0) valEl.textContent = v-1;
      });
      plus.addEventListener("click", ()=>{
        let v = parseInt(valEl.textContent); valEl.textContent = v+1;
      });
    });
  });

  // akƒ±llƒ± kilit ‚Äî her giri≈üte kontrol
  const rows = table.querySelectorAll("tr");
  rows.forEach((row, idx)=>{
    if(idx===0) return; // ba≈ülƒ±k
    row.querySelectorAll("input,.secenek,button").forEach(el=>{
      el.addEventListener("input", ()=>smartLock(idx));
      el.addEventListener("click",  ()=>smartLock(idx));
    });
  });
}

function clearPartnerBitmeInSameRow(cell, teamPairs){
  const row = cell.getAttribute("data-row");
  const myCol = parseInt(cell.getAttribute("data-col"),10);
  let partnerCol = null;
  teamPairs.forEach(pair=>{
    if(pair.includes(myCol)){ partnerCol = pair[0]===myCol ? pair[1] : pair[0]; }
  });
  if(partnerCol===null) return;

  const partnerCell = document.querySelector(`.player-cell[data-row='${row}'][data-col='${partnerCol}']`);
  if(!partnerCell) return;

  const pKat1 = partnerCell.querySelector(".kat1");
  const pKat2 = partnerCell.querySelector(".kat2");
  const pBitmeler = pKat2.querySelectorAll(".bitme");
  const pOkey = pKat2.querySelector(".okey");

  // partnerin bitmelerini sƒ±fƒ±rla
  pBitmeler.forEach(b=>{ b.classList.remove("aktif"); b.style.display="inline-block"; });
  pOkey.classList.add("hidden"); pOkey.classList.remove("aktif");
  pKat1.style.display="block"; // a√ßma geri
}

function rowHasData(rowEl){
  // herhangi bir aktif se√ßim var mƒ±?
  if(rowEl.querySelector(".secenek.aktif")) return true;
  // herhangi bir ceza sayacƒ± >0 mƒ±?
  const counters = rowEl.querySelectorAll(".deger");
  for(const c of counters){ if(parseInt(c.textContent)>0) return true; }
  // herhangi bir "elinde" inputu dolu mu?
  const nums = rowEl.querySelectorAll("input[type='number']");
  for(const n of nums){ if(n.value!=="") return true; }
  return false;
}

function smartLock(indexInDom){
  const rows = document.querySelectorAll("#skorTablo tr");
  if(indexInDom<=1) return; // 1: ilk veri satƒ±rƒ±
  const prev = rows[indexInDom-1];
  const curr = rows[indexInDom];

  const currHas = rowHasData(curr);
  if(currHas){
    // kilitle
    if(!prev.classList.contains("locked")){
      prev.classList.add("locked");
      prev.querySelectorAll("input,.secenek,button").forEach(e=>e.disabled=true);
    }
  }else{
    // hi√ß veri yoksa kilidi √ß√∂z
    if(prev.classList.contains("locked")){
      prev.classList.remove("locked");
      prev.querySelectorAll("input,.secenek,button").forEach(e=>e.disabled=false);
    }
  }
}

function yeniOyun(){
  document.getElementById("oyunEkrani").classList.add("hidden");
  document.getElementById("ayarEkrani").classList.remove("hidden");
  oyunTuruDegisti();
}
</script>
</body>
</html>