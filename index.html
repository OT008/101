<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Okey 101 EÅŸli (Bireysel) ArayÃ¼z TaslaÄŸÄ±</title>
<style>

input[type=number]::-webkit-inner-spin-button,
input[type=number]::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

input[type=number] {
  -moz-appearance: textfield;
}

body {
  font-family: "Segoe UI", sans-serif;
  background: #f3f6fb;
  color: #2c3e50;
  margin: 0;
  padding: 20px;
}

.container {
  max-width: 1100px;
  margin: auto;
  background: white;
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  overflow: hidden;
}

table {
  width: 100%;
  border-collapse: collapse;
}

th, td {
  border: 1px solid #ddd;
  text-align: center;
  vertical-align: top;
  padding: 10px;
}

/* --- BaÅŸlÄ±k SatÄ±rÄ± --- */
th {
  background: #4a90e2;
  color: white;
  font-weight: bold;
  font-size: 15px;
}

/* --- Oyuncu Ä°simleri --- */
.oyuncu-isim {
  background: transparent;
  border: none;
  outline: none;
  color: white;
  font-weight: 600;
  font-size: 15px;
  text-align: center;
  width: 100%;
}
.oyuncu-isim:focus {
  color: white;
  background: transparent;
}

/* --- Oyuncu HÃ¼creleri --- */
.player-cell {
  background: #f9f9f9;
  border-radius: 6px;
  padding: 6px;
}

/* --- AÃ§ma Durumu AlanÄ± --- */
.kategori {
  border: 1px solid #eee;
  background: #fff;
  margin-bottom: 6px;
  border-radius: 6px;
  padding: 4px;
}
.kategori h4 {
  margin: 4px 0;
  color: #4a90e2;
  font-size: 13px;
}
.secenek {
  display: inline-flex;
  align-items: stretch;
  justify-content: center;
  vertical-align: middle;

  min-height: 28px;        /* sabit yÃ¼kseklik */
  padding: 4px 12px;       /* metin Ã§evresinde denge */
  box-sizing: border-box;  /* padding'i yÃ¼ksekliÄŸe dahil et */
  
  background: #4a90e2;
  color: white;
  border-radius: 6px;
  margin: 2px;
  cursor: pointer;
  font-weight: 600;
  font-size: 13px;
  line-height: normal;     /* fontun dikey hizasÄ±nÄ± doÄŸal bÄ±rak */
  transition: background 0.2s;
}

.secenek:hover {
  background: #357abd;
}
.secenek.aktif {
  background: #2ecc71;
}

/* --- Kalan GiriÅŸi (tÄ±klayÄ±nca aÃ§Ä±lacak input iÃ§in stil) --- */
.kalan-input {
  width: 50px;
  text-align: center;
  font-weight: bold;
  color: white;
  background: #4a90e2;
  border: none;
  outline: none;
  border-radius: 6px;
  font-size: 13px;
}

/* --- Cezalar AlanÄ± --- */
.ceza-satiri {
  margin: 4px 0;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  font-size: 13px;
}
.ceza-satiri button {
  width: 24px;
  height: 24px;
  border: none;
  border-radius: 5px;
  color: white;
  font-weight: bold;
  cursor: pointer;
}
.ceza-satiri .azalt { background: #e74c3c; }
.ceza-satiri .artir { background: #2ecc71; }
.ceza-satiri span {
  font-weight: bold;
  color: #2c3e50;
}
/* --- Genel buton --- */
.btn {
  background: #e74c3c;
  color: #fff;
  border: none;
  padding: 10px 14px;
  border-radius: 8px;
  font-weight: 700;
  cursor: pointer;
  margin: 16px auto;
  display: block;
}
.btn:hover { opacity: .9; }

/* --- Masa SayÄ±sÄ± Butonu --- */
.masa-btn {
  display: inline-block;
  background: #4a90e2;
  color: white;
  padding: 4px 10px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  transition: background 0.2s;
}
.masa-btn:hover { background: #357abd; }
.masa-btn.aktif { background: #2ecc71; }

/* --- Pasif Elementler --- */
.pasif {
  opacity: 0.5;
  pointer-events: none !important;
}

/* --- Toplam Puanlar SatÄ±rÄ± --- */
tfoot td {
  background: #eef4ff;
  font-weight: bold;
  font-size: 15px;
  color: #2c3e50;
  border-top: 2px solid #4a90e2;
}
tfoot td:first-child {
  background: #4a90e2;
  color: white;
}
</style>
</head>
<body onload="roleriAta(); toplamPuanHesapla();">

<div class="container">
  <table>
    <thead>
      <tr>
        <th>El</th>
        <th><input type="text" class="oyuncu-isim" placeholder="Oyuncu 1"></th>
        <th><input type="text" class="oyuncu-isim" placeholder="Oyuncu 2"></th>
        <th><input type="text" class="oyuncu-isim" placeholder="Oyuncu 3"></th>
        <th><input type="text" class="oyuncu-isim" placeholder="Oyuncu 4"></th>
      </tr>
    </thead>

    <tbody>
      <tr>
        <td><b>1</b></td>

        <td class="player-cell">
          <div class="kategori">
            <h4>AÃ§ma Durumu</h4>
            <div class="secenek" data-role="acmadi">AÃ§amadÄ±</div>
            <div class="secenek kalan" data-role="kalan">Kalan</div>
            <div class="secenek" data-role="bitti">Bitti</div>
          </div>
          <div class="kategori">
            <h4>Cezalar</h4>
            <div class="masa-btn">Masa SayÄ±sÄ±</div>
            <div class="ceza-satiri">Ä°ÅŸlek:
              <button class="azalt">-</button>
              <span>0</span>
              <button class="artir">+</button>
            </div>
            <div class="ceza-satiri">HatalÄ± AÃ§ma:
              <button class="azalt">-</button>
              <span>0</span>
              <button class="artir">+</button>
            </div>
            <div class="ceza-satiri">Okey KaptÄ±rma:
              <button class="azalt">-</button>
              <span>0</span>
              <button class="artir">+</button>
            </div>
          </div>
        </td>

        <td class="player-cell">
          <div class="kategori">
            <h4>AÃ§ma Durumu</h4>
            <div class="secenek" data-role="acmadi">AÃ§amadÄ±</div>
            <div class="secenek kalan" data-role="kalan">Kalan</div>
            <div class="secenek" data-role="bitti">Bitti</div>
          </div>
          <div class="kategori">
            <h4>Cezalar</h4>
            <div class="masa-btn">Masa SayÄ±sÄ±</div>
            <div class="ceza-satiri">Ä°ÅŸlek:
              <button class="azalt">-</button><span>0</span><button class="artir">+</button>
            </div>
            <div class="ceza-satiri">HatalÄ± AÃ§ma:
              <button class="azalt">-</button><span>0</span><button class="artir">+</button>
            </div>
            <div class="ceza-satiri">Okey KaptÄ±rma:
              <button class="azalt">-</button><span>0</span><button class="artir">+</button>
            </div>
          </div>
        </td>

        <td class="player-cell">
          <div class="kategori">
            <h4>AÃ§ma Durumu</h4>
            <div class="secenek" data-role="acmadi">AÃ§amadÄ±</div>
            <div class="secenek kalan" data-role="kalan">Kalan</div>
            <div class="secenek" data-role="bitti">Bitti</div>
          </div>
          <div class="kategori">
            <h4>Cezalar</h4>
            <div class="masa-btn">Masa SayÄ±sÄ±</div>
            <div class="ceza-satiri">Ä°ÅŸlek:
              <button class="azalt">-</button><span>0</span><button class="artir">+</button>
            </div>
            <div class="ceza-satiri">HatalÄ± AÃ§ma:
              <button class="azalt">-</button><span>0</span><button class="artir">+</button>
            </div>
            <div class="ceza-satiri">Okey KaptÄ±rma:
              <button class="azalt">-</button><span>0</span><button class="artir">+</button>
            </div>
          </div>
        </td>

        <td class="player-cell">
          <div class="kategori">
            <h4>AÃ§ma Durumu</h4>
            <div class="secenek" data-role="acmadi">AÃ§amadÄ±</div>
            <div class="secenek kalan" data-role="kalan">Kalan</div>
            <div class="secenek" data-role="bitti">Bitti</div>
          </div>
          <div class="kategori">
            <h4>Cezalar</h4>
            <div class="masa-btn">Masa SayÄ±sÄ±</div>
            <div class="ceza-satiri">Ä°ÅŸlek:
              <button class="azalt">-</button><span>0</span><button class="artir">+</button>
            </div>
            <div class="ceza-satiri">HatalÄ± AÃ§ma:
              <button class="azalt">-</button><span>0</span><button class="artir">+</button>
            </div>
            <div class="ceza-satiri">Okey KaptÄ±rma:
              <button class="azalt">-</button><span>0</span><button class="artir">+</button>
            </div>
          </div>
        </td>
      </tr>
    </tbody>

    <tfoot>
      <tr>
        <td>Toplam</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
      </tr>
    </tfoot>
  </table>
  <button class="btn" id="btnYeniOyun">Yeni Oyun</button>
</div>

<script>

// =========================  KAYDET / YÃœKLE / SIFIRLA (GitHub Uyumlu)  =========================
// LocalStorage ile ilgili tÃ¼m kod bloÄŸu KALDIRILMIÅžTIR.
// YENÄ° OYUN butonu sadece sayfayÄ± yeniden yÃ¼kler (resetler).

function yeniOyunSifirla() {
  location.reload(); // En gÃ¼venlisi: sayfayÄ± ilk haline al
}

document.getElementById('btnYeniOyun')?.addEventListener('click', yeniOyunSifirla);

// ===============================================================================

// --- BaÅŸlangÄ±Ã§: AÃ§ma Durumu Ã¼Ã§lÃ¼sÃ¼ne data-role ata (Sayfa yÃ¼klenince Ã§alÄ±ÅŸÄ±r) ---
function roleriAta() {
  document.querySelectorAll('.player-cell .kategori:first-child').forEach(kat => {
    const opts = kat.querySelectorAll('.secenek');
    if (opts[0]) opts[0].dataset.role = 'acmadi';
    if (opts[1]) { opts[1].dataset.role = 'kalan'; opts[1].classList.add('kalan'); }
    if (opts[2]) opts[2].dataset.role = 'bitti';
  });
}
// roleriAta(); // Zaten body onload ile Ã§aÄŸrÄ±lÄ±yor.

// --- YardÄ±mcÄ±: hÃ¼cre indexine gÃ¶re takÄ±m arkadaÅŸÄ±nÄ± bul ---
function takimEsIndex(cell) {
  const row = cell.closest('tr');
  const idx = Array.from(row.children).indexOf(cell);
  // El sÃ¼tunu 0. index; oyuncular 1..4 (1-2 ve 3-4 eÅŸ)
  if (idx === 1) return 2;
  if (idx === 2) return 1;
  if (idx === 3) return 4;
  if (idx === 4) return 3;
  return null;
}

function handleAcmadi(btn) {
  const kat = btn.closest('.kategori');
  const cell = btn.closest('.player-cell');
  const kalan = kat.querySelector('[data-role="kalan"]');
  const bitti = kat.querySelector('[data-role="bitti"]');
  const masaBtn = cell.querySelector('.masa-btn');

  const acikMi = btn.classList.toggle('aktif');

  if (acikMi) {
    // Buton aktif oldu â†’ diÄŸerlerini gizle
    if (kalan) kalan.style.display = 'none';
    if (bitti) bitti.style.display = 'none';
    if (masaBtn) masaBtn.style.display = 'none';
  } else {
    // Buton pasif oldu â†’ diÄŸerlerini geri gÃ¶ster
    if (kalan) kalan.style.display = 'inline-block';
    if (bitti) bitti.style.display = 'inline-block';
    if (masaBtn) masaBtn.style.display = 'inline-block';
  }
}

function handleKalan(btn) {
  const kat = btn.closest('.kategori');
  const acamadi = kat.querySelector('[data-role="acmadi"]');
  const bitti = kat.querySelector('[data-role="bitti"]');
  const cell = btn.closest('.player-cell');
  const masaBtn = cell.querySelector('.masa-btn');

  // AÃ§amadÄ± ve Bitti butonlarÄ±nÄ± gizle
  if (acamadi) acamadi.style.display = 'none';
  if (bitti) bitti.style.display = 'none';
  
  // Input oluÅŸtur
  const input = document.createElement('input');
  input.type = 'number';
  input.className = 'kalan-input';
  input.min = '1';
  input.max = '252';
  input.placeholder = '0';

  // Butonun yerini input alÄ±r
  btn.replaceWith(input);
  input.focus();
  
  // Kalan inputu varken Masa SayÄ±sÄ± butonu gizlenir
  if (masaBtn) masaBtn.style.display = 'none';

  // Input odak kaybedince kontrol et
  input.addEventListener('blur', () => {
    if (!input.value || +input.value < 1) {
      // DeÄŸer yoksa: inputu kaldÄ±r, butonu geri getir
      input.replaceWith(btn);
      if (acamadi) acamadi.style.display = 'inline-block';
      if (bitti) bitti.style.display = 'inline-block';
      if (masaBtn) masaBtn.style.display = 'inline-block';
    } else {
      // DeÄŸer varsa: inputu kalÄ±cÄ± hale getir
      input.value = String(Math.min(252, Math.max(1, +input.value)));
      input.style.color = 'white';
      input.style.fontWeight = 'bold';
    }
    toplamPuanHesapla(); // Input deÄŸeri deÄŸiÅŸtiÄŸinde puanÄ± tazele
  });
}

function handleBitti(btn) {
  const cell = btn.closest('.player-cell');
  const row = cell.closest('tr');
  const acmaKat = cell.querySelector('.kategori');
  const acamadi = acmaKat.querySelector('[data-role="acmadi"]');
  const kalanBtn = acmaKat.querySelector('[data-role="kalan"]');
  const masaBtn = cell.querySelector('.masa-btn');
  const aktifmiydi = btn.classList.contains('aktif');
  const esIdx = takimEsIndex(cell);

  // ðŸ”¹ Ä°lk tÄ±klama (aktifleÅŸme)
  if (!aktifmiydi) {
    btn.classList.add('aktif');

    // Kendi butonlarÄ±nÄ± gizle
    if (acamadi) acamadi.style.display = 'none';
    if (kalanBtn) kalanBtn.style.display = 'none';

    // Okey/Elden panelini ekle
    const ekstraDiv = document.createElement('div');
    ekstraDiv.className = 'bitti-ekstra';
    ekstraDiv.style.marginTop = '6px';
    ekstraDiv.innerHTML = `
      <div class="secenek okey">Okey ile</div>
      <div class="secenek elden">Elden</div>
    `;
    acmaKat.insertAdjacentElement('afterend', ekstraDiv);

    // DiÄŸer oyuncularÄ±n Bitti butonlarÄ±nÄ± gizle
    row.querySelectorAll('.player-cell').forEach(c => {
      if (c !== cell) {
        const b = c.querySelector('[data-role="bitti"]');
        if (b && !b.classList.contains('aktif')) b.style.display = 'none';
      }
    });

    // ðŸ”§ TakÄ±m arkadaÅŸÄ±nÄ± sÄ±fÄ±rla + gizle + MASA'yÄ± nÃ¶trle ve gÃ¶rÃ¼nÃ¼r yap
    if (esIdx) {
      const esCell = row.children[esIdx];
      const esAcma = esCell.querySelector('.kategori');
      const esMasa = esCell.querySelector('.masa-btn');
      
      // TakÄ±m arkadaÅŸÄ±nÄ±n bittiÄŸi durumda aÃ§ma/kalan/bitti durumu etkisizleÅŸir (sÄ±fÄ±r puan alÄ±r)
      if (esAcma) {
        esAcma.querySelectorAll('.secenek').forEach(s => s.classList.remove('aktif'));
        const kalInput = esAcma.querySelector('.kalan-input');
        if (kalInput) kalInput.remove();
        esAcma.style.display = 'none'; // AÃ§ma Durumu kategorisini gizle
      }
      if (esMasa) {
        esMasa.classList.remove('aktif');
        esMasa.style.display = 'inline-block'; // Masa butonu gÃ¶rÃ¼nÃ¼r kalsÄ±n (ceza alabilir)
      }
    }

  // ðŸ”¸ Ä°kinci tÄ±klama (geri alma)
  } else {
    btn.classList.remove('aktif');

    // Okey/Elden panelini kaldÄ±r
    const ekstra = cell.querySelector('.bitti-ekstra');
    if (ekstra) ekstra.remove();

    // Kendi butonlarÄ±nÄ± geri getir
    if (acamadi) acamadi.style.display = 'inline-block';
    if (kalanBtn) kalanBtn.style.display = 'inline-block';
    if (masaBtn) { masaBtn.classList.remove('aktif'); masaBtn.style.display = 'inline-block'; }

    // DiÄŸer oyuncularÄ±n Bitti butonlarÄ±nÄ± geri getirirken kontrol yap
    row.querySelectorAll('.player-cell').forEach(c => {
      if (c !== cell) {
        const b = c.querySelector('[data-role="bitti"]');
        const acmadiBtn = c.querySelector('[data-role="acmadi"]');
        const kalanInput = c.querySelector('.kalan-input');

        const aktifAcmadi = acmadiBtn && acmadiBtn.classList.contains('aktif');
        const kalanDegerGirildi = Boolean(kalanInput && kalanInput.value);

        if (b) {
          if (aktifAcmadi || kalanDegerGirildi) {
            b.style.display = 'none';
          } else {
            b.style.display = 'inline-block';
          }
        }
      }
    });

    // TakÄ±m arkadaÅŸÄ±nÄ± geri getir ve sÄ±ralÄ± ÅŸekilde sÄ±fÄ±rla
    if (esIdx) {
      const esCell = row.children[esIdx];
      const esAcma = esCell.querySelector('.kategori');
      if (esAcma) {
        esAcma.style.display = 'block'; // Kategoriyi geri gÃ¶ster

        // Kalan butonu yoksa yeniden oluÅŸtur (kalan inputu yerine)
        let kalanBtn = esAcma.querySelector('[data-role="kalan"]');
        if (!kalanBtn) {
          kalanBtn = document.createElement('div');
          kalanBtn.className = 'secenek kalan';
          kalanBtn.dataset.role = 'kalan';
          kalanBtn.textContent = 'Kalan';

          const bittiBtn = esAcma.querySelector('[data-role="bitti"]');
          if (bittiBtn) {
            bittiBtn.insertAdjacentElement('beforebegin', kalanBtn);
          } else {
            esAcma.appendChild(kalanBtn);
          }
        }

        // TÃ¼m butonlarÄ± aktiflikten Ã§Ä±kar ve gÃ¶rÃ¼nÃ¼r hale getir
        ['acmadi','kalan','bitti'].forEach(r => {
          const el = esAcma.querySelector(`[data-role="${r}"]`);
          if (el) {
            el.classList.remove('aktif');
            el.style.display = 'inline-block';
          }
        });
      }
    }
  }
}


document.addEventListener('click', (e) => {
  const btn = e.target.closest('.secenek, .masa-btn, .artir, .azalt');
  if (!btn) return;
  
  // TÄ±klanan element pasif ise iÅŸlem yapma
  if (btn.classList.contains('pasif')) return;

  // --- AÃ‡AMADI ---
  if (btn.dataset.role === 'acmadi') {
    handleAcmadi(btn);
  }
  // --- KALAN (buton) -> inputa dÃ¶nÃ¼ÅŸecek ---
  else if (btn.dataset.role === 'kalan') {
    handleKalan(btn);
  }
  // --- BÄ°TTÄ° (toggle) ---
  else if (btn.dataset.role === 'bitti') {
    handleBitti(btn);
  }
  // --- OKEY / ELDEN (Bitti sonrasÄ± Ã§Ä±kanlarÄ± tÄ±kla) ---
  else if (btn.classList.contains('okey') || btn.classList.contains('elden')) {
    btn.classList.toggle('aktif'); // birlikte de seÃ§ilebilir
  }
  // --- MASA SAYISI (toggle) ---
  else if (btn.classList.contains('masa-btn')) {
    btn.classList.toggle('aktif');
  }
  // --- CEZA BUTONLARI (artÄ±r/azalt, min 0) ---
  else if (btn.classList.contains('artir') || btn.classList.contains('azalt')) {
    const satir = btn.closest('.ceza-satiri');
    if (satir) {
      const degerEl = satir.querySelector('span');
      let val = parseInt(degerEl?.textContent || '0', 10) || 0;

      if (btn.classList.contains('artir')) {
        val += 1;
      } else {
        val = Math.max(0, val - 1); // min 0
      }

      degerEl.textContent = String(val);
    }
  }
  
  // TÃ¼m iÅŸlemlerden sonra puanÄ± ve el kontrolÃ¼nÃ¼ yap
  setTimeout(() => {
    toplamPuanHesapla();
    elKontrolVeYeniEkle();
  }, 0);
});

// Ä°sim inputlarÄ± puanÄ± etkilemez ama temizlik iÃ§in input dinleyicisi ekleyelim
document.addEventListener('input', (e) => {
  if (e.target.classList.contains('oyuncu-isim')) {
    // Sadece input tetikleyici, puan hesaplamasÄ± yapmayÄ±z.
  }
});

function tumOyuncularAldiMi(row) {
  const cells = row.querySelectorAll('.player-cell');
  // Son satÄ±r boÅŸsa yeni el ekleme
  let tumuTamam = Array.from(cells).every(cell => {
    const acmaKat = cell.querySelector('.kategori');
    if (!acmaKat) return false;

    const aktifAcma = acmaKat.querySelector('.secenek[data-role="acmadi"].aktif');
    const kalanInput = cell.querySelector('.kalan-input');
    const bittiBtn = cell.querySelector('.secenek[data-role="bitti"].aktif');
    
    // AÃ§amadÄ±, Kalan inputu veya Bitti seÃ§ilmiÅŸ mi?
    if (aktifAcma || kalanInput || bittiBtn) return true;
    
    // TakÄ±m arkadaÅŸÄ± bitti ise bu oyuncu da tamam sayÄ±lÄ±r
    const esIdx = takimEsIndex(cell);
    if (esIdx) {
      const esCell = row.children[esIdx];
      const esBitti = esCell.querySelector('[data-role="bitti"].aktif');
      if (esBitti) return true;
    }
    
    // HiÃ§bir ÅŸey seÃ§ilmemiÅŸse
    return false;
  });
  
  return tumuTamam;
}

// --- Yeni el ekleme fonksiyonu ---
function yeniElEkle() {
  const tbody = document.querySelector('tbody');
  const satirlar = tbody.querySelectorAll('tr');
  const sonSatir = satirlar[satirlar.length - 1];
  const yeniElNo = satirlar.length + 1;
  
  // Son elin gerÃ§ekten tamamlandÄ±ÄŸÄ±ndan emin ol
  if (!tumOyuncularAldiMi(sonSatir)) return;

  const yeniSatir = sonSatir.cloneNode(true);
  yeniSatir.querySelector('td:first-child').innerHTML = `<b>${yeniElNo}</b>`;
  
  // Yeni satÄ±rÄ± sÄ±fÄ±rla
  yeniSatir.querySelectorAll('.secenek').forEach(s => {
    s.classList.remove('aktif', 'pasif');
    s.style.display = 'inline-block';
    s.style.opacity = '1';
    s.style.pointerEvents = 'auto';
  });
  yeniSatir.querySelectorAll('.kalan-input').forEach(i => i.remove());
  yeniSatir.querySelectorAll('.bitti-ekstra').forEach(e => e.remove());
  yeniSatir.querySelectorAll('.masa-btn').forEach(b => {
    b.classList.remove('aktif', 'pasif');
    b.style.display = 'inline-block';
    b.style.opacity = '1';
    b.style.pointerEvents = 'auto';
  });
  yeniSatir.querySelectorAll('.ceza-satiri span').forEach(sp => sp.textContent = '0');
  yeniSatir.querySelectorAll('.ceza-satiri button').forEach(b => {
    b.classList.remove('pasif');
    b.style.opacity = '1';
    b.style.pointerEvents = 'auto';
  });
  yeniSatir.querySelectorAll('.player-cell .kategori').forEach(k => {
    k.style.display = 'block'; // GizlenmiÅŸ aÃ§ma kategorilerini geri getir
  });
  
  // Eksik kalan butonu varsa ekle (cloneNode ile gelmesi gerek ama garanti olsun)
  yeniSatir.querySelectorAll('.player-cell').forEach(cell => {
    const acmaKat = cell.querySelector('.kategori');
    if (acmaKat && !acmaKat.querySelector('[data-role="kalan"]')) {
      const kalanBtn = document.createElement('div');
      kalanBtn.className = 'secenek kalan';
      kalanBtn.dataset.role = 'kalan';
      kalanBtn.textContent = 'Kalan';
      const bittiBtn = acmaKat.querySelector('[data-role="bitti"]');
      if (bittiBtn) bittiBtn.insertAdjacentElement('beforebegin', kalanBtn);
    }
  });

  tbody.appendChild(yeniSatir);
  roleriAta(); // Yeni satÄ±r iÃ§in rolleri tekrar ata
}

// El KontrolÃ¼ ve PasifleÅŸtirme/AktifleÅŸtirme
function elKontrolVeYeniEkle() {
  const tbody = document.querySelector('tbody');
  const satirlar = tbody.querySelectorAll('tr');
  if (satirlar.length < 1) return;

  const sonSatir = satirlar[satirlar.length - 1];

  // 1. Yeni El Ekleme KontrolÃ¼
  if (tumOyuncularAldiMi(sonSatir)) {
    yeniElEkle();
    // Yeni el eklenince pasifleÅŸtirme de yap
    const aktifSatirlar = document.querySelectorAll('tbody tr');
    if (aktifSatirlar.length >= 2) {
      const onceki = aktifSatirlar[aktifSatirlar.length - 2];
      onceki.querySelectorAll('.secenek, .masa-btn, .artir, .azalt, .kalan-input').forEach(el => {
        el.classList.add('pasif');
      });
    }
    return; // Yeni el eklendi, pasifleÅŸtirme yapÄ±ldÄ±, Ã§Ä±k.
  }

  // 2. PasifleÅŸtirme / AktifleÅŸtirme (son el doluysa bir Ã¶ncekini pasifleÅŸtir)
  if (satirlar.length >= 2) {
    const oncekiSatir = satirlar[satirlar.length - 2];

    const aktifVarMi = sonSatir.querySelector('.secenek.aktif, .masa-btn.aktif, .bitti-ekstra');
    const kalanInputVarMi = sonSatir.querySelector('.kalan-input');
    let cezaVarMi = false;
    sonSatir.querySelectorAll('.ceza-satiri span').forEach(sp => {
      if (parseInt(sp.textContent || '0', 10) > 0) cezaVarMi = true;
    });

    if (aktifVarMi || kalanInputVarMi || cezaVarMi) {
      // Son elde bir hareket varsa Ã¶nceki eli pasifleÅŸtir
      oncekiSatir.querySelectorAll('.secenek, .masa-btn, .artir, .azalt, .kalan-input').forEach(el => {
        el.classList.add('pasif');
      });
    } else {
      // Son elde hiÃ§bir ÅŸey yoksa Ã¶nceki eli geri aktif et
      oncekiSatir.querySelectorAll('.secenek, .masa-btn, .artir, .azalt, .kalan-input').forEach(el => {
        el.classList.remove('pasif');
      });
    }
  }
}

// ðŸ”¹ TOPLAM PUAN HESAPLAMA FONKSÄ°YONU
function toplamPuanHesapla() {
  const tbody = document.querySelector('tbody');
  const satirlar = tbody.querySelectorAll('tr');
  const toplamlar = [0, 0, 0, 0]; // Oyuncu 1-4 toplam puanlarÄ±

  satirlar.forEach(row => {
    const hucreler = row.querySelectorAll('.player-cell');
    let bitenIndex = null;
    let carpim = 1;

    // ðŸ”¹ Ã–nce kimin "bitti" olduÄŸunu ve Ã§arpanÄ± tespit et
    hucreler.forEach((cell, i) => {
      const bittiBtn = cell.querySelector('.secenek[data-role="bitti"].aktif');
      if (bittiBtn) {
        // Bitti Ekstra paneli yoksa okey/elden kontrolÃ¼ yapma
        const ekstra = cell.querySelector('.bitti-ekstra');
        const okey = ekstra?.querySelector('.okey.aktif');
        const elden = ekstra?.querySelector('.elden.aktif');

        bitenIndex = i;
        if (okey && elden) carpim = 4;
        else if (okey || elden) carpim = 2;
        else carpim = 1;
      }
    });

    const elPuanlari = [0, 0, 0, 0];

    // ðŸ”¸ Her oyuncunun puanÄ±nÄ± hesapla (Ã¶nce ceza/kalan puanlarÄ±nÄ± topla)
    hucreler.forEach((cell, i) => {
      const acmadi = cell.querySelector('.secenek[data-role="acmadi"].aktif');
      const kalanInput = cell.querySelector('.kalan-input');
      const bittiBtn = cell.querySelector('.secenek[data-role="bitti"].aktif');
      const masa = cell.querySelector('.masa-btn.aktif');
      const cezalar = cell.querySelectorAll('.ceza-satiri span');

      let puan = 0;

      // ðŸŸ¢ AÃ§ma durumuna gÃ¶re puan (sadece kalan/aÃ§amadÄ±/bitti cezasÄ±)
      if (acmadi) puan += 202;
      else if (kalanInput && kalanInput.value) puan += parseInt(kalanInput.value);
      else if (bittiBtn) {
        // Biten oyuncu puanÄ± burada hesaplanmaz, sadece ceza/masa kÄ±smÄ± kalÄ±r
        const ekstra = cell.querySelector('.bitti-ekstra');
        const okey = ekstra?.querySelector('.okey.aktif');
        const elden = ekstra?.querySelector('.elden.aktif');
        
        if (okey && elden) puan -= 202;
        else if (okey) puan -= 101;
        else if (elden) puan -= 202;
        else puan -= 101;
      }

      // ðŸ”¸ Masa cezasÄ± (eksi puan)
      if (masa) puan += 101; // Ceza olduÄŸu iÃ§in puanÄ± artÄ±rÄ±r

      // ðŸ”¸ Cezalar (Ä°ÅŸlek, HatalÄ±, Okey KaptÄ±rma)
      cezalar.forEach(span => {
        const adet = parseInt(span.textContent || '0', 10);
        if (adet > 0) puan += adet * 101;
      });

      elPuanlari[i] = puan;
    });

    // ðŸ”¹ TakÄ±m eÅŸleri
    const takimEs = { 0: 1, 1: 0, 2: 3, 3: 2 };

    // ðŸ”¸ Biten oyuncu varsa Ã¶zel durumlar (Ã‡arpan UygulamasÄ±)
    if (bitenIndex !== null) {
      const esIndex = takimEs[bitenIndex];
      const bitenOyuncuCezasi = elPuanlari[bitenIndex] + (elPuanlari[bitenIndex] > 0 ? 0 : -elPuanlari[bitenIndex]) * (carpim - 1);
      
      // Biten oyuncunun puanÄ± (sadece ceza puanlarÄ± Ã§arpÄ±lacak)
      elPuanlari[bitenIndex] = elPuanlari[bitenIndex] * carpim;

      // TakÄ±m arkadaÅŸÄ±: Sadece kendi cezasÄ±nÄ± alÄ±r (aÃ§ma/kalan/bitti durumu 0)
      if (esIndex !== null) {
          let esCeza = 0;
          const esCell = hucreler[esIndex];
          const esMasa = esCell.querySelector('.masa-btn.aktif');
          const esCezalar = esCell.querySelectorAll('.ceza-satiri span');
          
          if (esMasa) esCeza += 101;
          esCezalar.forEach(span => esCeza += parseInt(span.textContent || '0', 10) * 101);
          
          elPuanlari[esIndex] = esCeza * carpim; // TakÄ±m arkadaÅŸÄ±nÄ±n cezalarÄ± Ã§arpÄ±lÄ±r
      }
      
      // DiÄŸer iki oyuncunun puanÄ± Ã§arpÄ±lÄ±r
      hucreler.forEach((cell, i) => {
        if (i !== bitenIndex && i !== esIndex) {
          const acmadi = cell.querySelector('.secenek[data-role="acmadi"].aktif');
          const kalanInput = cell.querySelector('.kalan-input');

          let puanAcmaKalan = 0;
          if (acmadi) puanAcmaKalan = 202;
          else if (kalanInput && kalanInput.value) puanAcmaKalan = parseInt(kalanInput.value);

          // Toplam puan = (Acma/Kalan puanÄ± * Ã‡arpan) + Ceza puanlarÄ±
          elPuanlari[i] = puanAcmaKalan * carpim + (elPuanlari[i] - puanAcmaKalan);
        }
      });
    }

    // ðŸ”¹ ToplamlarÄ± ekle
    elPuanlari.forEach((p, i) => toplamlar[i] += p);
  });

  // ðŸ”¸ Alt kÄ±sÄ±mdaki â€œToplamâ€ satÄ±rÄ±nÄ± gÃ¼ncelle
  const tfoot = document.querySelector('tfoot tr:last-child');
  if (tfoot) {
    const tds = tfoot.querySelectorAll('td');
    toplamlar.forEach((t, i) => {
      if (tds[i + 1]) tds[i + 1].textContent = t;
    });
  }
}
</script>

</body>
</html>
