<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Okey 101 Skor Takip Sistemi</title>
<style>

input[type=number]::-webkit-inner-spin-button,
input[type=number]::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

input[type=number] {
  -moz-appearance: textfield;
}

body {
  font-family: "Segoe UI", sans-serif;
  background: #f3f6fb;
  color: #2c3e50;
  margin: 0;
  padding: 0;
}

h1 {
  text-align: center;
  padding: 20px;
  background: #4a90e2;
  color: white;
  margin: 0 0 20px;
}

.container {
  max-width: 1100px;
  margin: auto;
  background: white;
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
  padding: 20px;
}

label {
  display: block;
  margin-bottom: 6px;
  font-weight: 600;
  font-size: 14px;
}

input,
select {
  padding: 8px 10px;
  border-radius: 10px;
  border: 1px solid #ccc;
  width: 50%;
  box-sizing: border-box;
  font-size: 14px;
  height: 36px;
  background-color: #fff;
}

input:focus,
select:focus {
  outline: none;
  border-color: #4a90e2;
  box-shadow: 0 0 4px rgba(74, 144, 226, 0.4);
}

/* ðŸ§¾ TABLO â€“ klasik eski tasarÄ±m */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}

th,
td {
  border: 1px solid #ddd;
  text-align: center;
  vertical-align: middle;
  padding: 8px;
}

th {
  background: #4a90e2;
  color: white;
}

.player-cell {
  font-size: 13px;
  text-align: center;
}

/* ðŸŸ¦ Kategoriler */
.kategori {
  border: 1px solid #eee;
  margin: 2px;
  padding: 4px;
  border-radius: 6px;
  background: #f9f9f9;
}

.kategori h4 {
  margin: 2px 0;
  font-size: 13px;
  color: #4a90e2;
}

/* ðŸŸ© SeÃ§enek kutularÄ± */
.secenek {
  display: inline-block;
  margin: 4px 6px;
  padding: 3px 6px;
  border-radius: 5px;
  cursor: pointer;
  transition: all 0.2s;
}

.secenek:hover {
  background: #e0edff;
}

.secenek.aktif {
  background: #2ecc71;
  color: white;
  font-weight: bold;
}

/* ðŸŸ¥ Ceza satÄ±rlarÄ± */
.ceza-satiri {
  margin: 3px 0;
}

.ceza-satiri button {
  width: 25px;
  height: 25px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  color: white;
  font-weight: bold;
  font-size: 14px;
}

.ceza-satiri .azalt {
  background: #e74c3c;
}

.ceza-satiri .azalt:hover {
  background: #c0392b;
}

.ceza-satiri .artir {
  background: #2ecc71;
}

.ceza-satiri .artir:hover {
  background: #27ae60;
}

/* ðŸ”¹ FORM DÃœZENLERÄ° */
.yan-yana {
  display: flex;
  gap: 0px;
  align-items: flex-end;
}

.yan-yana > div {
  flex: 1;
}

.oyuncu-grup {
  display: flex;
  gap: 0px;
  flex-wrap: wrap;
  justify-content: space-between;
}

.oyuncu-grup div {
  flex: 1 1 45%;
  min-width: 200px;
}

.oyuncu-grup label {
  display: block;
  margin-bottom: 5px;
  text-align: left;
}

/* ðŸ”¹ GENEL GÃ–RSEL DENGE */
.section-title {
  background: #e9f0ff;
  padding: 10px;
  font-weight: bold;
  margin-top: 20px;
  border-radius: 6px;
  font-size: 15px;
  color: #2c3e50;
  text-align: center;
}

/* ðŸ”¹ Butonlar */
.btn {
  background: #4a90e2;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  cursor: pointer;
  margin-top: 20px;
  font-weight: bold;
  width: 100%;
}

.btn:hover {
  background: #357abd;
}

.hidden {
  display: none;
}

/* ðŸ”¹ SayÄ± input oklarÄ±nÄ± kaldÄ±r */
input[type=number]::-webkit-inner-spin-button,
input[type=number]::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

input[type=number] {
  -moz-appearance: textfield;
}


	
</style>
</head>
<body>
<h1>ðŸŸ¢ Okey 101 Skor Takip Sistemi</h1>

<!-- GÄ°RÄ°Åž EKRANI -->
<div class="container" id="ayarEkrani">
  <div class="section-title">Ayarlar</div>
<div class="yan-yana">
  <div style="width:50%;">
    <label>Oyun TÃ¼rÃ¼:</label>
    <select id="oyunTuru" onchange="oyunTuruDegisti()">
      <option value="tek">Tekli</option>
      <option value="esli">EÅŸli</option>
    </select>
  </div>
  <div style="width:50%;">
    <label>Oynanacak Tur SayÄ±sÄ±</label>
    <input type="number" id="tur" min="3" max="33" value="11">
  </div>
</div>
  <div id="esliSecenekleri" class="hidden">
    <label>EÅŸli Oyun Tipi:</label>
    <select id="esliTipi" onchange="oyunTuruDegisti()">
      <option value="birlikte">TakÄ±m puanlÄ±</option>
      <option value="ayri">Bireysel puanlÄ±</option>
    </select>
  </div>
  <div class="section-title">Oyuncu/TakÄ±m Ä°simleri</div>
  <div id="isimler"></div>
	<div class="section-title">Oyun Puanlama</div>
	<div style="display:flex;gap:0px;">
      <div style="width:50%;">
	    <label>AÃ§amama (+)</label><input type="number" id="p_acamama" value="202">
	    <label>Bitirme (-)</label><input type="number" id="p_bitirme" value="-101">
	    <label>Elden Bitirme (-)</label><input type="number" id="p_eldenbit" value="-202">		
	    <label>Ã‡iftle Bitirme (-)</label><input type="number" id="p_ciftbit" value="-202">
      </div>
      <div style="width:50%;">
	    <label>Okey ile Bitirme (-)</label><input type="number" id="p_okeybit" value="-202">
	    <label>Elden Okey ile Bitirme (-)</label><input type="number" id="p_eldenokey" value="-404">
	    <label>Ã‡iftle Okey ile Bitirme (-)</label><input type="number" id="p_ciftokey" value="-404">
	    <label>Masa SayÄ±sÄ±nÄ± AÅŸma (-)</label><input type="number" id="p_masaAsma" value="-101">
      </div>
    </div>
  <div class="section-title">Ceza PuanlamasÄ±</div>
  <div style="display:flex;gap:0px;">
    <div style="width:50%;">
      <label>Ä°ÅŸlek Atma (+)</label><input type="number" id="c_islek" value="101">
      <label>Okey KaptÄ±rma (+)</label><input type="number" id="c_okeykaptir" value="101">
    </div>
    <div style="width:50%;">
      <label>HatalÄ± AÃ§ma (+)</label><input type="number" id="c_hatali" value="101">
    </div>
  </div>
  <button class="btn" onclick="oyunaBasla()">Hesaplama Tablosu OluÅŸtur</button>
</div>

<!-- ?? OYUN EKRANI -->
<div class="container hidden" id="oyunEkrani">
  <div id="oyunBilgisi"></div>
  <table id="skorTablo"></table>
  <button class="btn" onclick="yeniOyun()">Yeni Tablo OluÅŸtur</button>
</div>

<script>
function oyunTuruDegisti(){
  const tur=document.getElementById("oyunTuru").value;
  const tip=document.getElementById("esliTipi")?document.getElementById("esliTipi").value:"birlikte";
  const esliSecenekleri=document.getElementById("esliSecenekleri");
  const isimler=document.getElementById("isimler");
  if(tur==="esli") esliSecenekleri.classList.remove("hidden");
  else esliSecenekleri.classList.add("hidden");

  if(tur==="tek"||(tur==="esli"&&tip==="ayri")){
isimler.innerHTML=`
  <div class="oyuncu-grup">
    <div><label>Oyuncu 1:</label><input id="oy1" value="Oyuncu 1"></div>
    <div><label>Oyuncu 2:</label><input id="oy2" value="Oyuncu 2"></div>
    <div><label>Oyuncu 3:</label><input id="oy3" value="Oyuncu 3"></div>
    <div><label>Oyuncu 4:</label><input id="oy4" value="Oyuncu 4"></div>
  </div>`;
  } else {
    isimler.innerHTML=`
      <label>TakÄ±m 1:</label><input id="oy1" value="TakÄ±m 1">
      <label>TakÄ±m 2:</label><input id="oy3" value="TakÄ±m 2">`;
  }
}
oyunTuruDegisti();

function oyunaBasla(){
  const turSayisi = parseInt(document.getElementById("tur").value);
  const oyuncular = Array.from(document.querySelectorAll("#isimler input")).map(i => i.value);
  const oyunTuru = document.getElementById("oyunTuru").value;
  const esliTipi = document.getElementById("esliTipi") ? document.getElementById("esliTipi").value : "birlikte";
  const esliAyrÄ± = (oyunTuru === "esli" && esliTipi === "ayri");
  window.esliAyrÄ± = esliAyrÄ±;
  document.getElementById("ayarEkrani").classList.add("hidden");
  document.getElementById("oyunEkrani").classList.remove("hidden");
  document.getElementById("oyunBilgisi").innerHTML=`<h3>Tur SayÄ±sÄ±: ${turSayisi}</h3>`;

  let html="<tr><th>El</th>";
  oyuncular.forEach(o=>html+=`<th>${o}</th>`);
  html+="</tr>";

  for(let el=1;el<=turSayisi;el++){
    html+=`<tr><td><b>${el}</b></td>`;
    oyuncular.forEach((o,idx)=>{
      html+=`<td id='cell_${el}_${idx}' class='player-cell'>
        <div class='kategori kat1'>
          <h4>AÃ§ma Durumu</h4>
          <span class='secenek acmadi'>AÃ§amadÄ±</span>
          <span>Elinde: <input type='number' class='elinde' min='0' max='200'></span>
        </div>
        <div class='kategori kat2'>
          <h4>Bitme TÃ¼rÃ¼</h4>
          <span class='secenek bitme'>Bitti</span>
          <span class='secenek bitme'>Elden Bitti</span>
          <span class='secenek bitme'>Ã‡iftle Bitti</span>
          <span class='secenek okey hidden'>Okey ile</span>
        </div>
        <div class='kategori kat3'>
          <h4>Cezalar / Masa AÅŸÄ±mÄ±</h4>
          <span class='secenek masa'>Masa AÅŸtÄ±</span>
          <div class='ceza-satiri'>Ä°ÅŸlek Atma:
            <button class='azalt'>-</button>
            <span class='deger islek'>0</span>
            <button class='artir'>+</button>
          </div>
          <div class='ceza-satiri'>HatalÄ± AÃ§ma:
            <button class='azalt'>-</button>
            <span class='deger hatali'>0</span>
            <button class='artir'>+</button>
          </div>
          <div class='ceza-satiri'>Okey KaptÄ±rma:
            <button class='azalt'>-</button>
            <span class='deger kaptir'>0</span>
            <button class='artir'>+</button>
          </div>
        </div>
      </td>`;
    });
    html+="</tr>";
  }
  document.getElementById("skorTablo").innerHTML=html;
  aktiflestirDavranislar();
}

function aktiflestirDavranislar(){
  document.querySelectorAll(".player-cell").forEach(cell=>{
    const kat1=cell.querySelector(".kat1"), kat2=cell.querySelector(".kat2");
    const acmadi=kat1.querySelector(".acmadi"), elinde=kat1.querySelector(".elinde");
    const bitmeler=kat2.querySelectorAll(".bitme");
    const okey=kat2.querySelector(".okey");
    const masaBtn=cell.querySelector(".masa");

    acmadi.addEventListener("click",()=>{
      if(!acmadi.classList.contains("aktif")){
        acmadi.classList.add("aktif");
        elinde.disabled=true;
		elinde.parentElement.style.display = "none";
        kat2.style.display="none";
      }else{
        acmadi.classList.remove("aktif");
        elinde.disabled=false;
		elinde.parentElement.style.display = "inline-block";
        kat2.style.display="block";
      }
    });
    elinde.addEventListener("input",()=>{
      if(elinde.value!==""){
        acmadi.style.display="none";
        kat2.style.display="none";
      }else{
        acmadi.style.display="inline-block";
        kat2.style.display="block";
      }
    });

	bitmeler.forEach(bit=>{
	  bit.addEventListener("click",()=>{
	  const aktifMi = bit.classList.contains("aktif");
      bitmeler.forEach(b=>{b.classList.remove("aktif");b.style.display="inline-block";});

      if(aktifMi){
		kat1.style.display="block";
		okey.classList.add("hidden");
		okey.classList.remove("aktif");
		
		if(window.esliAyrÄ±){
		  const id = cell.id;
		  const parca = id.split("_");
          const idx = parseInt(parca[2]);
          const takimEs = (idx % 2 === 0) ? idx + 1 : idx - 1;
		  const takimCell = document.getElementById(`cell_${parca[1]}_${takimEs}`);
		  if(takimCell){
		    takimCell.querySelector(".kat1").style.display = "block";
			takimCell.querySelector(".kat2").style.display = "block";
		  }
		}
	  } else {
		bit.classList.add("aktif");
		kat1.style.display="none";
		bitmeler.forEach(b=>{if(b!==bit)b.style.display="none";});
		
		okey.classList.remove("hidden");

      // ðŸŸ¢ EÅžLÄ° BÄ°RLÄ°KTE MODU: TakÄ±m arkadaÅŸÄ± iÅŸlemi
      if(window.esliAyrÄ±){
        const id = cell.id; 
        const parca = id.split("_");
        const idx = parseInt(parca[2]); 
        const takimEs = (idx % 2 === 0) ? idx + 1 : idx - 1;
        const takimCell = document.getElementById(`cell_${parca[1]}_${takimEs}`);
        if(takimCell){
          const elinde = takimCell.querySelector(".elinde");
          const acmadi = takimCell.querySelector(".acmadi");
          const bitmeler2 = takimCell.querySelectorAll(".bitme");
          elinde.value = "";
          acmadi.classList.remove("aktif");
          acmadi.style.display = "inline-block";
          bitmeler2.forEach(b=>{b.classList.remove("aktif"); b.style.display="inline-block";});
          takimCell.querySelector(".kat2").style.display="block";
          takimCell.querySelector(".kat1").style.display="none";
          takimCell.querySelector(".kat2").style.display="none";
			}
		  }
		}
      });
    });
    okey.addEventListener("click",()=>{okey.classList.toggle("aktif");});
    masaBtn.addEventListener("click",()=>{masaBtn.classList.toggle("aktif");});

    const cezaSatirlari=cell.querySelectorAll(".ceza-satiri");
    cezaSatirlari.forEach(row=>{
      const azalt=row.querySelector(".azalt");
      const artir=row.querySelector(".artir");
      const deger=row.querySelector(".deger");
      azalt.addEventListener("click",()=>{
        let val=parseInt(deger.textContent);
        if(val>0)deger.textContent=val-1;
      });
      artir.addEventListener("click",()=>{
        let val=parseInt(deger.textContent);
        deger.textContent=val+1;
      });
    });
  });

  const rows=document.querySelectorAll("#skorTablo tr");
  rows.forEach((r,i)=>{
    if(i===0)return;
    r.querySelectorAll("input,.secenek,button").forEach(el=>{
      el.oninput=()=>kilitleOnceki(i);
      el.onclick=()=>kilitleOnceki(i);
    });
  });
}

function kilitleOnceki(satirIndex){
  const rows=document.querySelectorAll("#skorTablo tr");
  if(satirIndex>1){
    const prev=rows[satirIndex-1];
    const current=rows[satirIndex];
    const currentInputs=current.querySelectorAll("input, .secenek.aktif, .deger");
    const currentHasValue=[...currentInputs].some(el=>{
      if(el.classList && el.classList.contains("deger")) return parseInt(el.textContent)>0;
      if(el.tagName==="INPUT"&&el.type==="number") return el.value!=="";
      return el.classList && el.classList.contains("aktif");
    });

    if(currentHasValue){
      if(!prev.classList.contains("locked")){
        prev.classList.add("locked");
        prev.querySelectorAll("input, .secenek, button").forEach(e=>e.disabled=true);
      }
    } else {
      if(prev.classList.contains("locked")){
        prev.classList.remove("locked");
        prev.querySelectorAll("input, .secenek, button").forEach(e=>e.disabled=false);
      }
    }
  }
}

function yeniOyun(){
  document.getElementById("oyunEkrani").classList.add("hidden");
  document.getElementById("ayarEkrani").classList.remove("hidden");
}

let toplamlar = []; // Her oyuncunun toplam puanÄ±

function sonrakiEliAc(gecerliEl) {
  const tablo = document.getElementById("skorTablo");
  const satirlar = tablo.querySelectorAll("tr");
  if (gecerliEl < satirlar.length - 1) {
    satirlar[gecerliEl + 1].style.display = "table-row";
  }
}

function elTamamlandiMi(elIndex) {
  const tablo = document.getElementById("skorTablo");
  const satir = tablo.querySelectorAll("tr")[elIndex];
  if (!satir) return false;
  const hucreler = satir.querySelectorAll(".player-cell");
  return [...hucreler].every(cell => {
    const acmadi = cell.querySelector(".acmadi.aktif");
    const elinde = cell.querySelector(".elinde").value !== "";
    const bitme = cell.querySelector(".bitme.aktif");
    return acmadi || elinde || bitme;
  });
}

function hesaplaPuanlar() {
  const tablo = document.getElementById("skorTablo");
  const satirlar = tablo.querySelectorAll("tr");
  const oyuncuSayisi = satirlar[0].querySelectorAll("th").length - 1;

  toplamlar = new Array(oyuncuSayisi).fill(0);

  // tÃ¼m satÄ±rlarÄ± gez
  satirlar.forEach((satir, i) => {
    if (i === 0) return; // baÅŸlÄ±k satÄ±rÄ±
    const hucreler = satir.querySelectorAll(".player-cell");
    hucreler.forEach((cell, j) => {
      let puan = 0;
      const acamadi = cell.querySelector(".acmadi").classList.contains("aktif");
      const elinde = parseInt(cell.querySelector(".elinde").value || 0);
      const bitme = [...cell.querySelectorAll(".bitme")].find(b => b.classList.contains("aktif"));
      const okey = cell.querySelector(".okey").classList.contains("aktif");
      const masaAsti = cell.querySelector(".masa").classList.contains("aktif");

      const P = {
        acamama: parseInt(document.getElementById("p_acamama").value),
        bitirme: parseInt(document.getElementById("p_bitirme").value),
        eldenbit: parseInt(document.getElementById("p_eldenbit").value),
        ciftbit: parseInt(document.getElementById("p_ciftbit").value),
        okeybit: parseInt(document.getElementById("p_okeybit").value),
        eldenokey: parseInt(document.getElementById("p_eldenokey").value),
        ciftokey: parseInt(document.getElementById("p_ciftokey").value),
        masaAsma: parseInt(document.getElementById("p_masaAsma").value),
      };

      const C = {
        islek: parseInt(cell.querySelector(".deger.islek").textContent),
        hatali: parseInt(cell.querySelector(".deger.hatali").textContent),
        kaptir: parseInt(cell.querySelector(".deger.kaptir").textContent),
        c_islek: parseInt(document.getElementById("c_islek").value),
        c_hatali: parseInt(document.getElementById("c_hatali").value),
        c_okeykaptir: parseInt(document.getElementById("c_okeykaptir").value),
      };

      // hesaplama mantÄ±ÄŸÄ±
      if (acamadi) puan += P.acamama;
      if (elinde) puan += elinde;
      if (bitme) {
        const tip = bitme.textContent;
        if (tip.includes("Elden")) puan += P.eldenbit;
        else if (tip.includes("Ã‡ift")) puan += P.ciftbit;
        else puan += P.bitirme;
        if (okey) {
          if (tip.includes("Elden")) puan += P.eldenokey;
          else if (tip.includes("Ã‡ift")) puan += P.ciftokey;
          else puan += P.okeybit;
        }
      }
      if (masaAsti) puan += P.masaAsma;

      // cezalar
      const cezaToplam =
        (C.islek * C.c_islek) +
        (C.hatali * C.c_hatali) +
        (C.kaptir * C.c_okeykaptir);

      puan -= cezaToplam;

      toplamlar[j] += puan;
    });
  });

  guncelleToplamGorunumu();
}

function guncelleToplamGorunumu() {
  let toplamDiv = document.getElementById("toplamPuanlar");
  if (!toplamDiv) {
    toplamDiv = document.createElement("div");
    toplamDiv.id = "toplamPuanlar";
    toplamDiv.className = "section-title";
    document.getElementById("oyunEkrani").appendChild(toplamDiv);
  }
  let html = "<h4>Toplam Puanlar</h4><table style='width:100%;text-align:center;border-collapse:collapse;'><tr>";
  const tablo = document.getElementById("skorTablo");
  const isimler = [...tablo.querySelectorAll("th")].slice(1).map(th => th.textContent);
  isimler.forEach((isim, i) => {
    html += `<th>${isim}</th>`;
  });
  html += "</tr><tr>";
  toplamlar.forEach(p => html += `<td>${p}</td>`);
  html += "</tr></table>";
  toplamDiv.innerHTML = html;
}

// Oyun davranÄ±ÅŸlarÄ± aktifken deÄŸiÅŸiklikleri dinle:
document.addEventListener("input", (e) => {
  if (e.target.closest(".player-cell")) {
    const td = e.target.closest("td");
    const id = td.id;
    const parca = id.split("_");
    const elNo = parseInt(parca[1]);
    if (elTamamlandiMi(elNo)) sonrakiEliAc(elNo);
    hesaplaPuanlar();
  }
});

document.addEventListener("click", (e) => {
  if (e.target.closest(".secenek")) {
    const td = e.target.closest("td");
    const id = td.id;
    const parca = id.split("_");
    const elNo = parseInt(parca[1]);
    if (elTamamlandiMi(elNo)) sonrakiEliAc(elNo);
    hesaplaPuanlar();
  }
});
</script>
</body>
</html>
